# æ¸¸æˆæ•°æ® Schema éªŒè¯ç³»ç»Ÿ

## ğŸ“‹ æ¦‚è¿°

è¿™ä¸ªéªŒè¯ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„ç±»å‹æ£€æŸ¥å’Œæ•°æ®éªŒè¯ï¼Œç¡®ä¿æ‰€æœ‰æ¸¸æˆæ•°æ®ï¼ˆæŠ€èƒ½ã€çŠ¶æ€ã€ç‰©å“ç­‰ï¼‰éƒ½ç¬¦åˆé¢„å®šä¹‰çš„ Schema è§„èŒƒã€‚

## âš ï¸ éªŒè¯ç­–ç•¥

**é‡è¦**ï¼šæœ¬ç³»ç»Ÿé‡‡ç”¨"å®½æ¾éªŒè¯"ç­–ç•¥ï¼š

- âœ… **ä¸ä¼šåœæ­¢è¿è¡Œ**ï¼šå³ä½¿æ•°æ®éªŒè¯å¤±è´¥ï¼Œæ¸¸æˆä»ä¼šç»§ç»­è¿è¡Œ
- âš ï¸ **æ˜¾ç¤ºè­¦å‘Š**ï¼šéªŒè¯é”™è¯¯ä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºä¸ºè­¦å‘Šï¼ˆé»„è‰²ï¼‰
- ğŸ” **è¯¦ç»†æ£€æŸ¥**ï¼šä½¿ç”¨å¼€å‘å·¥å…·ï¼ˆCtrl+Shift+Dï¼‰æŸ¥çœ‹å®Œæ•´çš„éªŒè¯æŠ¥å‘Š
- ğŸ¯ **å¼€å‘å‹å¥½**ï¼šå…è®¸ä½ è¾¹å¼€å‘è¾¹çœ‹åˆ°å“ªäº›æ•°æ®éœ€è¦ä¿®å¤

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

1. **ä¸ä¸­æ–­å¼€å‘æµç¨‹**ï¼šä½ å¯ä»¥å…ˆè®©åŠŸèƒ½è·‘èµ·æ¥ï¼Œç„¶åå†ä¿®å¤æ•°æ®æ ¼å¼
2. **æ¸è¿›å¼ä¿®å¤**ï¼šä¸éœ€è¦ä¸€æ¬¡æ€§ä¿®å¤æ‰€æœ‰é”™è¯¯
3. **æ›´å¥½çš„è°ƒè¯•ä½“éªŒ**ï¼šæ¸¸æˆèƒ½è¿è¡Œï¼Œä½ æ‰èƒ½æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£ç¡®
4. **ä¸“é—¨çš„éªŒè¯å·¥å…·**ï¼šæœ‰ç‹¬ç«‹çš„éªŒè¯å™¨æ¥åšå®Œæ•´æ£€æŸ¥

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### 1. Effect æšä¸¾å®šä¹‰

åœ¨ `effects.js` ä¸­å®šä¹‰äº†æ‰€æœ‰ effect å±æ€§çš„ä¸¥æ ¼æšä¸¾ï¼š

#### Effect Typesï¼ˆæ•ˆæœç±»å‹ï¼‰
- `damage` - ä¼¤å®³
- `heal` / `heal_all` - æ²»ç–—
- `recoverMp` / `recover_mp` - æ¢å¤ MP
- `applyStatus` - æ–½åŠ çŠ¶æ€
- `cureStatus` - æ²»ç–—çŠ¶æ€
- `buff` / `stat_boost` - å±æ€§å¢ç›Š
- `stun` - çœ©æ™•
- `immunity` - å…ç–«ï¼ˆå¦‚ç ´ç¢ç›‘ç‰¢ï¼‰
- `revive` / `revive_enemy` - å¤æ´»
- `fullRestore` - å®Œå…¨æ¢å¤

#### Trigger Typesï¼ˆè§¦å‘å™¨ç±»å‹ï¼‰
- `battle_start` / `battle_end` - æˆ˜æ–—å¼€å§‹/ç»“æŸ
- `turnStart` / `turnEnd` - å›åˆå¼€å§‹/ç»“æŸ
- `checkAction` - æ£€æŸ¥è¡ŒåŠ¨ï¼ˆç”¨äºæ§åˆ¶å’Œå…ç–«ï¼‰
- `beforeAction` / `afterAction` - è¡ŒåŠ¨å‰/å
- `on_damage_taken` / `on_damage_dealt` - å—åˆ°/é€ æˆä¼¤å®³æ—¶
- `on_cc_skip` - è·³è¿‡æ§åˆ¶æ—¶
- `passive` - è¢«åŠ¨ï¼ˆæ€»æ˜¯ç”Ÿæ•ˆï¼‰

#### Scaling Typesï¼ˆç¼©æ”¾ç±»å‹ï¼‰
- `atk` / `mag` / `def` / `str` / `spd` - åŸºäºå±æ€§
- `maxHp` / `currentHp` - åŸºäºç”Ÿå‘½å€¼
- `damage_dealt` - åŸºäºé€ æˆçš„ä¼¤å®³

#### Target Typesï¼ˆç›®æ ‡ç±»å‹ï¼‰
- `self` - è‡ªå·±
- `enemy` / `allEnemies` - æ•Œäºº/æ‰€æœ‰æ•Œäºº
- `ally` / `allAllies` - å‹æ–¹/æ‰€æœ‰å‹æ–¹

#### Element Typesï¼ˆå…ƒç´ ç±»å‹ï¼‰
- `elements.physical` - ç‰©ç†
- `elements.fire` / `water` / `wind` / `earth` - ç«/æ°´/é£/åœ°
- `elements.lightning` / `light` / `dark` - é›·/å…‰/æš—

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šæµè§ˆå™¨å†…éªŒè¯ï¼ˆæ¨èï¼‰

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š
```bash
npm run dev
```

2. åœ¨æ¸¸æˆä¸­æŒ‰å¿«æ·é”®ï¼š
```
Ctrl + Shift + D
```

3. åˆ‡æ¢åˆ°"ğŸ” æ•°æ®éªŒè¯"æ ‡ç­¾é¡µ

4. ç‚¹å‡»"å¼€å§‹éªŒè¯"æŒ‰é’®

5. æŸ¥çœ‹éªŒè¯ç»“æœå’Œé”™è¯¯è¯¦æƒ…

### æ–¹æ³•äºŒï¼šå‘½ä»¤è¡ŒéªŒè¯

ç”±äº Node.js ç¯å¢ƒé™åˆ¶ï¼ˆä¸æ”¯æŒ Vite åˆ«åï¼‰ï¼Œç›®å‰å‘½ä»¤è¡ŒéªŒè¯æš‚æ—¶ä¸å¯ç”¨ã€‚è¯·ä½¿ç”¨æµè§ˆå™¨å†…éªŒè¯ã€‚

## ğŸ“ Schema å®šä¹‰

### Effect Schema ç»“æ„

```javascript
{
  // å¿…éœ€å­—æ®µ
  type: EffectType,           // æ•ˆæœç±»å‹ï¼ˆæšä¸¾ï¼‰

  // æ ¸å¿ƒå‚æ•°
  value: number,              // æ•°å€¼
  percent: number,            // ç™¾åˆ†æ¯” (0.0-1.0)
  scaling: ScalingType,       // ç¼©æ”¾ç±»å‹ï¼ˆæšä¸¾ï¼‰
  element: ElementType,       // å…ƒç´ ç±»å‹ï¼ˆæšä¸¾ï¼‰

  // çŠ¶æ€ç›¸å…³
  status: ID,                 // çŠ¶æ€ ID
  duration: number,           // æŒç»­å›åˆæ•°
  chance: number,             // è§¦å‘æ¦‚ç‡ (0.0-1.0)
  mode: StatusApplicationMode, // æ–½åŠ æ¨¡å¼

  // ç›®æ ‡ç›¸å…³
  target: TargetType,         // ç›®æ ‡ç±»å‹ï¼ˆæšä¸¾ï¼‰

  // å±æ€§ç›¸å…³
  stat: StatType,             // å±æ€§ç±»å‹ï¼ˆæšä¸¾ï¼‰

  // è§¦å‘å™¨
  trigger: TriggerType,       // è§¦å‘ç±»å‹ï¼ˆæšä¸¾ï¼‰

  // éšæœºåŒ–
  minOffset: number,          // æœ€å°åç§»
  maxOffset: number,          // æœ€å¤§åç§»

  // å¤šæ¬¡è§¦å‘
  times: number,              // å›ºå®šæ¬¡æ•°
  minTimes: number,           // æœ€å°æ¬¡æ•°
  maxTimes: number,           // æœ€å¤§æ¬¡æ•°

  // å †å 
  maxStack: number,           // æœ€å¤§å †å å±‚æ•°

  // å…¶ä»–
  ignoreDefense: boolean,     // æ— è§†é˜²å¾¡
  canCrit: boolean,           // å¯æš´å‡»
  critRate: number,           // æš´å‡»ç‡
  critDamage: number          // æš´å‡»å€ç‡
}
```

## ğŸ”§ æ·»åŠ æ–°çš„æšä¸¾å€¼

å¦‚æœéœ€è¦æ·»åŠ æ–°çš„ effect ç±»å‹æˆ–å±æ€§ï¼š

1. æ‰“å¼€ `src/data/schemas/effects.js`
2. åœ¨ç›¸åº”çš„æšä¸¾å¯¹è±¡ä¸­æ·»åŠ æ–°å€¼ï¼š

```javascript
export const EffectType = {
  // ... ç°æœ‰å€¼
  NEW_TYPE: 'newType',  // æ·»åŠ æ–°ç±»å‹
};
```

3. ä¿å­˜åï¼Œæ‰€æœ‰ä½¿ç”¨æ–°ç±»å‹çš„æ•°æ®éƒ½ä¼šè‡ªåŠ¨å—åˆ°éªŒè¯

## âŒ å¸¸è§é”™è¯¯

### é”™è¯¯ 1ï¼šæ— æ•ˆçš„ Effect Type
```
âŒ effects.0.type: Expected one of: damage, heal, ...
```
**è§£å†³æ–¹æ³•**ï¼šæ£€æŸ¥ `type` å­—æ®µï¼Œç¡®ä¿ä½¿ç”¨äº† `effects.js` ä¸­å®šä¹‰çš„æšä¸¾å€¼ã€‚

### é”™è¯¯ 2ï¼šæ— æ•ˆçš„ Trigger
```
âŒ effects.0.trigger: Expected one of: battle_start, turnStart, ...
```
**è§£å†³æ–¹æ³•**ï¼šæ£€æŸ¥ `trigger` å­—æ®µï¼Œç¡®ä¿ä½¿ç”¨äº†æ­£ç¡®çš„è§¦å‘å™¨åç§°ã€‚

### é”™è¯¯ 3ï¼šæ— æ•ˆçš„ Scaling
```
âŒ effects.0.scaling: Expected one of: atk, mag, maxHp, ...
```
**è§£å†³æ–¹æ³•**ï¼šæ£€æŸ¥ `scaling` å­—æ®µï¼Œä½¿ç”¨é¢„å®šä¹‰çš„ç¼©æ”¾ç±»å‹ã€‚

### é”™è¯¯ 4ï¼šæœªè¯†åˆ«çš„å­—æ®µ
```
âŒ effects.0.unknownField: Unrecognized key
```
**è§£å†³æ–¹æ³•**ï¼šSchema ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œä¸å…è®¸æœªå®šä¹‰çš„å­—æ®µã€‚åˆ é™¤è¯¥å­—æ®µæˆ–åœ¨ Schema ä¸­æ·»åŠ å®šä¹‰ã€‚

## ğŸ“Š éªŒè¯ç¤ºä¾‹

### æ­£ç¡®ç¤ºä¾‹

```javascript
{
  id: 'skill_fireball',
  name: { zh: 'ç«çƒæœ¯', en: 'Fireball' },
  effects: [
    {
      type: 'damage',           // âœ… æ­£ç¡®çš„ç±»å‹
      scaling: 'mag',           // âœ… æ­£ç¡®çš„ç¼©æ”¾
      value: 1.5,
      element: 'elements.fire', // âœ… æ­£ç¡®çš„å…ƒç´ 
      minOffset: -0.1,
      maxOffset: 0.1
    }
  ]
}
```

### é”™è¯¯ç¤ºä¾‹

```javascript
{
  id: 'skill_invalid',
  effects: [
    {
      type: 'attack',          // âŒ é”™è¯¯ï¼šåº”è¯¥æ˜¯ 'damage'
      scaling: 'attack',       // âŒ é”™è¯¯ï¼šåº”è¯¥æ˜¯ 'atk'
      element: 'fire',         // âŒ é”™è¯¯ï¼šåº”è¯¥æ˜¯ 'elements.fire'
      randomField: 123         // âŒ é”™è¯¯ï¼šæœªå®šä¹‰çš„å­—æ®µ
    }
  ]
}
```

## ğŸ¨ è‡ªå®šä¹‰éªŒè¯

å¦‚æœéœ€è¦è‡ªå®šä¹‰éªŒè¯é€»è¾‘ï¼Œå¯ä»¥æ‰©å±• `validator.js`ï¼š

```javascript
import { validateEffects } from './effects.js';

// è‡ªå®šä¹‰éªŒè¯å‡½æ•°
export const validateCustomData = (data) => {
  // 1. åŸºç¡€ Schema éªŒè¯
  validateEffects(data.effects, 'CustomData');
  
  // 2. è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘éªŒè¯
  if (data.type === 'damage' && !data.element) {
    throw new Error('Damage effects must have an element');
  }
};
```

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `effects.js` - Effect æšä¸¾å’Œ Schema å®šä¹‰
- `validator.js` - æ•°æ®éªŒè¯å·¥å…·
- `NAMING_CONVENTIONS.md` - â­ å‘½åè§„èŒƒï¼ˆå¿…è¯»ï¼ï¼‰
- `resources/skill.js` - æŠ€èƒ½ Schema
- `resources/status.js` - çŠ¶æ€ Schema
- `DevTools.vue` - æµè§ˆå™¨å†…éªŒè¯å·¥å…· UI
- `DataValidator.vue` - æ•°æ®éªŒè¯ç»„ä»¶

## ğŸ¤ è´¡çŒ®

æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼š
1. åœ¨ `effects.js` ä¸­æ·»åŠ æšä¸¾å®šä¹‰
2. æ›´æ–° `EffectSchema` æ·»åŠ æ–°å­—æ®µ
3. åœ¨éªŒè¯å™¨ä¸­æµ‹è¯•
4. æ›´æ–°æ­¤æ–‡æ¡£

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
