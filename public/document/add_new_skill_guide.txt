# 新增技能/物品效果修改指南

本指南总结了在 UITest 项目中添加新的技能或物品效果时需要修改的文件和步骤。

## 1. 核心数据配置

所有新技能和物品首先需要在数据文件中定义。

### 技能 (Skills)
- **文件路径**: `src/data/skills.js`
- **修改内容**: 在 `skillsDb` 对象中添加新的技能条目。
- **关键字段**:
    - `id`: 唯一标识符。
    - `targetType`: 目标类型（重要），决定 UI 如何选择目标。
        - `enemy`: 单体敌人
        - `allEnemies`: 全体敌人
        - `ally`: 单体队友（存活）
        - `allAllies`: 全体队友（存活）
        - `deadAlly`: 单体队友（死亡）
        - `allDeadAllies`: 全体队友（死亡）
    - `effects`: 效果数组，定义技能的具体行为。

### 物品 (Items)
- **文件路径**: `src/data/items.js`
- **修改内容**: 在 `itemsDb` 对象中添加新的物品条目。
- **关键字段**:
    - `type`: 通常为 `itemTypes.consumable`。
    - `targetType`: 同技能 `targetType`。
    - `effects`: 效果数组。

## 2. 图标配置 (可选)

如果使用了新的图标键名（如 `icon_revive_all`），需要在映射表中添加。

- **文件路径**: `src/utils/iconMap.js`
- **修改内容**: 在 `iconMap` 对象中添加键值对，可以是 emoji 或图片路径。

## 3. UI 交互逻辑

如果引入了新的**目标选择类型**（例如 `allDeadAllies`），需要更新 UI 组件以支持该类型的选择流程。

- **文件路径**: `src/interface/pages/systems/BattleSystem.vue`
- **修改内容**:
    - **`selectSkill` 方法**: 处理技能选择。如果是群体或特殊目标，可能需要直接触发 `playerAction` 而不是进入选择模式。
    - **`selectItem` 方法**: 处理物品选择。同上。
    - **`isSelectingAlly` / `isSelectingDead` 计算属性**: 确保 UI 正确显示可选择的目标高亮。

## 4. 战斗逻辑核心

这是实现效果具体行为的地方。

### 效果路由 (Effects Router)
- **文件路径**: `src/game/battle/effects.js`
- **函数**: `processEffect`
- **修改内容**:
    - 如果是**现有效果类型**（如 `damage`, `heal`, `revive`），通常**不需要修改**此文件，只需在数据中正确配置参数。
    - 如果是**全新效果类型**（如 `drain` (吸血), `steal` (偷窃)），需要在 `switch (effect.type)` 中添加新的 case 分支。

### 目标遍历与执行 (Battle Store)
- **文件路径**: `src/stores/battle.js`
- **函数**: `playerAction` (技能部分) 和 `handleItemEffect` (物品部分)
- **修改内容**:
    - 负责根据 `targetType` 解析出具体的目标列表。
    - 如果引入了新的目标类型（如 `allDeadAllies`），需要在这里添加逻辑来遍历 `partySlots`（包括前排 `front` 和后排 `back`）并调用 `processEffect`。

### 数值计算 (Mechanics)
- **文件路径**: `src/game/battle/mechanics.js`
- **函数**: `calculateDamage`
- **修改内容**:
    - 如果引入了新的**伤害计算公式**（例如基于 `currentHp` 或 `def` 计算伤害），需要在这里修改计算逻辑。

## 5. 示例：添加“群体复活”流程

1.  **数据**: 在 `skills.js` / `items.js` 定义条目，`targetType: 'allDeadAllies'`, `effects: [{ type: 'revive', value: 0.5 }]`。
2.  **UI**: 在 `BattleSystem.vue` 的 `selectSkill/selectItem` 中，检测到 `allDeadAllies` 则直接触发动作，不进入单选模式。
3.  **Store**: 在 `battle.js` 中，添加对 `allDeadAllies` 的处理，遍历所有 `partySlots` (front & back)，对 HP <= 0 的单位调用 `processEffect`。
4.  **图标**: 在 `iconMap.js` 添加对应图标。

---
*Generated by AI Assistant*

